{"version":3,"file":"component---src-pages-fan-stats-js-c3def6a64573abf7e62c.js","mappings":"wHAuBIA,GACJ,E,QAAA,IAAQ,SAAcC,EAAYC,GAChC,OAAOC,MAAMC,UAAUC,MAAMC,KAAKJ,EAAM,GAAGF,KAAKC,EAClD,IACA,K,uBC1BO,SAASM,EAAUC,EAAQC,GAChC,OAAUD,EAAM,IAAIC,GAAkB,IAAXD,EAAe,IAAM,GAClD,C,0PCSA,MAAME,EAAgBA,CAACC,EAAGC,IAAMD,EAAIC,EAE9BC,EAAeA,IAAMC,EAAAA,cAAA,QAAMC,OAAO,cACtCD,EAAAA,cAAA,SAAOE,KAAK,OAAOC,KAAK,WAAWC,YAAY,2BAA2BC,KAAK,OAC/EL,EAAAA,cAAA,cAAQ,mBAGJM,EAAaC,IAAA,IAAC,SAACC,GAASD,EAAA,OAAKP,EAAAA,cAAA,KAAGS,KAAI,iCAAmCD,EAAQ,YAAY,IAAEA,EAAa,EAE1GE,EAAYC,IAAiB,IAAhB,SAACH,GAASG,EAC3B,OAAIH,EACKR,EAAAA,cAAAA,EAAAA,SAAA,KAAEA,EAAAA,cAACM,EAAU,CAACE,SAAUA,IAAY,gBAEtC,WAAW,EAGdI,EAAWC,IAAA,IAAC,GAACC,EAAE,KAAEX,GAAKU,EAAA,gBAAeC,EAAE,IAAIC,IAAQZ,EAAK,EAGxDa,GAAeC,EAAAA,EAAAA,IADCC,IAAA,IAAC,QAACC,GAAQD,EAAA,OAAKC,CAAO,IAGtCC,EAAWC,IAAmC,IAAlC,KAACC,EAAI,MAAEC,EAAK,MAAEC,EAAK,OAAEC,GAAOJ,EAC5C,MAAMK,EAAUC,OAAOC,KAAKL,GAEtBM,GAASC,EAAAA,EAAAA,GAAKH,OAAOI,OAAOR,GAAOS,KAAIC,IAAA,IAAC,MAACC,GAAMD,EAAA,OAAKC,CAAK,KACzDC,EAAYnB,EAAaQ,GACzBY,EAAapB,EAAaS,GAEhC,OAAOzB,EAAAA,cAAAA,EAAAA,SAAA,KACLA,EAAAA,cAAA,SAAGA,EAAAA,cAACM,EAAU,CAACE,SAAUc,EAAKd,WAAY,YAASf,EAAAA,EAAAA,GAAUiC,EAAQW,OAAQ,QAAQ,YAAS5C,EAAAA,EAAAA,GAAUoC,EAAOQ,OAAQ,SAAS,WAAQ5C,EAAAA,EAAAA,GAAU0C,EAAUE,OAAQ,kBAAkB,oBAAiB5C,EAAAA,EAAAA,GAAU2C,EAAWC,OAAQ,eAAe,YAEnPrC,EAAAA,cAAA,UAAI,SACJA,EAAAA,cAAA,WACGd,EAAAA,EAAAA,GAAKU,EAAe8B,GAASM,KAAKM,IACjC,MAAM,KAACC,EAAI,MAAEL,GAASX,EAAMe,GAC5B,OAAOtC,EAAAA,cAAA,MAAIwC,IAAKF,GACdtC,EAAAA,cAACyC,EAAAA,GAAI,CAACC,GAAE,SAAWJ,GAAWC,GAC7B,OACDvC,EAAAA,cAACyC,EAAAA,GAAI,CAACC,GAAI9B,EAASsB,IAASA,EAAM/B,KAAK,KAAG+B,EAAMS,UAC7C,KAIT3C,EAAAA,cAAA,UAAI,UACJA,EAAAA,cAAA,UACG6B,EAAOG,KAAKE,GAAUlC,EAAAA,cAAA,MAAIwC,IAAKN,EAAMpB,IAAId,EAAAA,cAACyC,EAAAA,GAAI,CAACC,GAAI9B,EAASsB,IAASA,EAAM/B,KAAK,KAAG+B,EAAMS,cAG5F3C,EAAAA,cAAA,UAAI,SACJA,EAAAA,cAAA,UACGmC,EAAUH,KAAIY,IAAA,IAAC,QAACzB,EAAO,UAAE0B,GAAUD,EAAA,OAAK5C,EAAAA,cAAA,MAAIwC,IAAKrB,GAASnB,EAAAA,cAACyC,EAAAA,GAAI,CAACC,GAAE,SAAWvB,GAAY0B,GAAsB,KAGlH7C,EAAAA,cAAA,UAAI,UACJA,EAAAA,cAAA,UACGoC,EAAWJ,KAAKc,GAAU9C,EAAAA,cAAA,MAAIwC,IAAKM,EAAM3B,SAASnB,EAAAA,cAACyC,EAAAA,GAAI,CAACC,GAAE,SAAWI,EAAM3B,SAAY2B,EAAMD,eAE/F,EAGU,SAASE,EAAYC,GAAoB,IAADC,EAAA,IAAlB,SAACN,EAAQ,KAAEO,GAAKF,EACnD,MAAMG,EAAc,IAAIC,gBAAgBT,EAASU,QAAQC,IAAI,aACvD,EAACC,EAAS,EAACC,IAAeC,EAAAA,EAAAA,aAC1B,EAACC,EAAU,EAACC,IAAgBF,EAAAA,EAAAA,UAAS,CAAC,IACtC,EAACG,EAAU,EAACC,IAAgBJ,EAAAA,EAAAA,aAC5B,EAACK,EAAW,EAACC,IAAiBN,EAAAA,EAAAA,aAEpCO,EAAAA,EAAAA,YAAU,KACJb,GACFc,MAAM,iCAAiCd,EAAW,SAC/Ce,MAAMC,GAAaA,EAASC,SAC5BF,MAAME,IACDA,SAAAA,EAAM9C,MACRkC,EAAY,CACVlC,KAAM8C,EAAK9C,KACXC,MAAO6C,EAAK9C,KAAK+C,YAAY,GACzBC,KAAKC,MAAMH,EAAK9C,KAAK+C,YAAY,IACjC,IAER,GAEN,GACC,CAAClB,IAEJ,MACEqB,YAAaC,MAAOC,GACpBC,wBAAyBF,MAAOG,GAChCC,cAAeJ,MAAOK,GACtBC,aAAcN,MAAOO,GACrBC,cAAeR,MAAOS,IACpBhC,EACEiC,GAAeC,EAAAA,EAAAA,GAAKC,EAAAA,EAAIT,GACxBU,GAAUF,EAAAA,EAAAA,GAAKC,EAAAA,EAAIX,GACnBa,GAAWH,EAAAA,EAAAA,GAAKC,EAAAA,EAAIL,GACpBQ,GAAYJ,EAAAA,EAAAA,GAAKC,EAAAA,EAAIH,GACrBO,GAAeC,EAAAA,EAAAA,GAAOL,EAAAA,EAAIP,GAqChC,OAnCAd,EAAAA,EAAAA,YAAU,KACR,GAAIT,SAAAA,EAAUhC,MAAO,CACnB,MAAMA,EAAQgC,EAAShC,MAAMoE,QAAO,CAACjC,EAAWkC,KAC9C,MAAMC,EAAaD,EAAeE,MAAM,KAAK,GAAGC,QAAQ,aAAc,SAChEC,EAAWT,GAASU,EAAAA,EAAAA,GAAOJ,EAAY,SAC7C,GAAIG,SAAAA,EAAUlF,GAAI,CAChB,MAAMoB,EAAQsD,GAAUS,EAAAA,EAAAA,GAAOD,EAASE,SAAU,OAClD,MAAO,IACFxC,EACH,CAACsC,EAASlF,IAAK,IACVkF,EACH9D,SAGN,CACA,OAAOwB,CAAS,GACf,CAAC,GACJC,EAAapC,GAEb,MAAMqC,EAAYjC,OAAOI,OAAOR,GAC7BoE,QAAO,CAACQ,EAAQC,IAASD,EAAOE,OAAO,CAACD,EAAKE,KAAMF,EAAKG,KAAMH,EAAKI,KAAMJ,EAAKK,QAASL,EAAKM,SAAShB,QAAQ5E,GAAO6F,QAAQ7F,OAAO,IAEnIkB,KAAK4E,GAAUtB,GAAQW,EAAAA,EAAAA,GAAOW,EAAO,SACrCC,SAAQC,IAAA,IAAC,QAACC,GAAQD,EAAA,OAAKE,OAAOD,GAASjB,MAAM,IAAI,IAEjD9D,KAAKiF,GAAe9B,GAAac,EAAAA,EAAAA,GAAOgB,EAAY,SAEvDpD,EAAaD,GAEb,MAAME,EAAaF,EAChBiD,SAASK,GAASzB,GAAaQ,EAAAA,EAAAA,GAAOiB,EAAKpG,GAAI,qBAClDiD,EAAcD,EAChB,IACC,CAACP,IAEGvD,EAAAA,cAACmH,EAAAA,EAAM,CAACC,UAAU,gBACvBpH,EAAAA,cAACqH,EAAAA,EAAG,CAACC,MAAM,mBACXtH,EAAAA,cAAA,UAAIA,EAAAA,cAACU,EAAS,CAACF,SAAU+C,SAAc,QAANN,EAARM,EAAUjC,YAAI,IAAA2B,OAAN,EAARA,EAAgBzC,YACxC2C,EACGI,SAAAA,EAAUjC,KACRK,OAAOC,KAAK8B,GAAWrB,OACrBrC,EAAAA,cAACoB,EAAQ,CAACG,MAAOmC,EAAWlC,MAAOoC,EAAWnC,OAAQqC,EAAYxC,KAAMiC,EAASjC,OACjFtB,EAAAA,cAAAA,EAAAA,SAAA,KAAEA,EAAAA,cAAA,SAAG,6CAA0CA,EAAAA,cAAA,KAAGS,KAAK,sDAAqD,uCAAuC,MAAMT,EAAAA,cAACD,EAAY,OACxKwD,SAAAA,EAAUgE,MACRvH,EAAAA,cAAAA,EAAAA,SAAA,KAAEA,EAAAA,cAAA,SAAG,+BAA+BA,EAAAA,cAACD,EAAY,OACjDC,EAAAA,cAAA,SAAG,cACPA,EAAAA,cAACD,EAAY,MAGrB,C","sources":["webpack://almost-dead-net/./node_modules/ramda/es/sort.js","webpack://almost-dead-net/./src/helpers/string_helpers.js","webpack://almost-dead-net/./src/pages/fan-stats.js"],"sourcesContent":["import _curry2 from \"./internal/_curry2.js\";\n/**\n * Returns a copy of the list, sorted according to the comparator function,\n * which should accept two values at a time and return a negative number if the\n * first value is smaller, a positive number if it's larger, and zero if they\n * are equal. Please note that this is a **copy** of the list. It does not\n * modify the original.\n *\n * @func\n * @memberOf R\n * @since v0.1.0\n * @category List\n * @sig ((a, a) -> Number) -> [a] -> [a]\n * @param {Function} comparator A sorting function :: a -> b -> Int\n * @param {Array} list The list to sort\n * @return {Array} a new array with its elements sorted by the comparator function.\n * @see R.ascend, R.descend\n * @example\n *\n *      const diff = function(a, b) { return a - b; };\n *      R.sort(diff, [4,2,7,5]); //=> [2, 4, 5, 7]\n */\n\nvar sort = /*#__PURE__*/\n_curry2(function sort(comparator, list) {\n  return Array.prototype.slice.call(list, 0).sort(comparator);\n});\nexport default sort;","/* Appends an \"s\" to the end of `word` if warranted by the value of `number` */\nexport function pluralize(number, word) {\n  return `${number} ${word}${number !== 1 ? 's' : ''}`\n}\n","import React, {useEffect, useState} from 'react'\nimport {graphql, Link} from 'gatsby'\nimport {filter, find, propEq, sort, uniq, uniqBy, __} from 'ramda'\nimport slugify from 'slugify'\n\nimport Layout from '../components/layout'\nimport SEO from '../components/seo'\n\nimport {pluralize} from '../helpers/string_helpers'\n\nimport './fan-stats.css'\n\nconst numericalSort = (a, b) => a - b\n\nconst UsernameForm = () => <form action=\"/fan-stats\">\n  <input type=\"text\" name=\"username\" placeholder=\"your username on The Lot\" size=\"30\" />\n  <button>generate stats</button>\n</form>\n\nconst LinkedUser = ({username}) => <a href={`https://lot.almost-dead.net/u/${username}/summary`}>@{username}</a>\n\nconst PageTitle = ({username}) => {\n  if (username) {\n    return <><LinkedUser username={username} />'s Fan Stats</>\n  }\n  return 'Fan Stats'\n}\n\nconst venueURL = ({id, name}) => `/venue/${id}-${slugify(name)}`\n\nconst extractSongId = ({song_id}) => song_id\nconst uniqBySongId = uniqBy(extractSongId)\n\nconst FanStats = ({user, shows, songs, teases}) => {\n  const showIDs = Object.keys(shows)\n  // const songIDs = Object.keys(songs)\n  const venues = uniq(Object.values(shows).map(({venue}) => venue))\n  const uniqSongs = uniqBySongId(songs)\n  const uniqTeases = uniqBySongId(teases)\n\n  return <>\n    <p><LinkedUser username={user.username} /> was at {pluralize(showIDs.length, 'show')} across {pluralize(venues.length, 'venue')}, with {pluralize(uniqSongs.length, 'different song')} performed, and {pluralize(uniqTeases.length, 'unique song')} teased!</p>\n\n    <h2>Shows</h2>\n    <ol>\n      {sort(numericalSort, showIDs).map((showID) => {\n        const {date, venue} = shows[showID]\n        return <li key={showID}>\n          <Link to={`/show/${showID}`}>{date}</Link>\n          {' at '}\n          <Link to={venueURL(venue)}>{venue.name}, {venue.location}</Link>\n        </li>\n      })}\n    </ol>\n\n    <h2>Venues</h2>\n    <ol>\n      {venues.map((venue) => <li key={venue.id}><Link to={venueURL(venue)}>{venue.name}, {venue.location}</Link></li>)}\n    </ol>\n\n    <h2>Songs</h2>\n    <ol>\n      {uniqSongs.map(({song_id, song_name}) => <li key={song_id}><Link to={`/song/${song_id}`}>{song_name}</Link></li>)}\n    </ol>\n\n    <h2>Teases</h2>\n    <ol>\n      {uniqTeases.map((tease) => <li key={tease.song_id}><Link to={`/song/${tease.song_id}`}>{tease.song_name}</Link></li>)}\n    </ol>\n  </>\n}\n\nexport default function FanStatsPage({location, data}) {\n  const usernameRaw = new URLSearchParams(location.search).get('username')\n  const [userJson, setUserJson] = useState()\n  const [showsData, setShowsData] = useState({})\n  const [perfsData, setPerfsData] = useState()\n  const [teasesData, setTeasesData] = useState()\n\n  useEffect(() => {\n    if (usernameRaw) {\n      fetch(`https://lot.almost-dead.net/u/${usernameRaw}.json`)\n        .then((response) => response.json())\n        .then((json) => {\n          if (json?.user) {\n            setUserJson({\n              user: json.user,\n              shows: json.user.user_fields[1]\n                ? JSON.parse(json.user.user_fields[1]) // TODO This will throw if the field is invalid JSON (which happens...)\n                : [],\n            })\n          }\n        })\n    }\n  }, [usernameRaw])\n\n  const {\n    allSetsCsv: {nodes: allSets},\n    allSongperformancesCsv: {nodes: allSongPerfs},\n    allTeasesCsv: {nodes: allTeases},\n    allShowsCsv: {nodes: allShows},\n    allVenuesCsv: {nodes: allVenues},\n  } = data\n  const findSongPerf = find(__, allSongPerfs)\n  const findSet = find(__, allSets)\n  const findShow = find(__, allShows)\n  const findVenue = find(__, allVenues)\n  const filterTeases = filter(__, allTeases)\n\n  useEffect(() => {\n    if (userJson?.shows) {\n      const shows = userJson.shows.reduce((showsData, showDateString) => {\n        const showDMYYYY = showDateString.split(' ')[0].replace(/\\/(\\d{2})$/, '/20$1')\n        const showData = findShow(propEq(showDMYYYY, 'date'))\n        if (showData?.id) {\n          const venue = findVenue(propEq(showData.venue_id, 'id'))\n          return {\n            ...showsData,\n            [showData.id]: {\n              ...showData,\n              venue,\n            },\n          }\n        }\n        return showsData\n      }, {})\n      setShowsData(shows)\n\n      const perfsData = Object.values(shows)\n        .reduce((setIDs, show) => setIDs.concat([show.set1, show.set2, show.set3, show.encore1, show.encore2].filter((id) => Boolean(id))), [])\n        // now it is an array of set ID strings...\n        .map((setID) => findSet(propEq(setID, 'id')))\n        .flatMap(({setlist}) => String(setlist).split(':'))\n        // now it is an array of songperf ID strings\n        .map((songPerfID) => findSongPerf(propEq(songPerfID, 'id')))\n        // now it is an array of songperf objs\n      setPerfsData(perfsData)\n\n      const teasesData = perfsData\n        .flatMap((perf) => filterTeases(propEq(perf.id, 'performance_id')))\n      setTeasesData(teasesData)\n    }\n  }, [userJson])\n\n  return <Layout className=\"fanstatspage\">\n    <SEO title=\"JRAD Fan Stats\" />\n    <h1><PageTitle username={userJson?.user?.username} /></h1>\n    {usernameRaw\n      ? userJson?.user\n        ? Object.keys(showsData).length\n          ? <FanStats shows={showsData} songs={perfsData} teases={teasesData} user={userJson.user} />\n          : <><p>No shows found! (Have you entered them in <a href=\"https://lot.almost-dead.net/my/preferences/profile\">your account preferences on The Lot</a>?)</p><UsernameForm/></>\n        : userJson?.error\n          ? <><p>Uh oh, error fetching data.</p><UsernameForm/></>\n          : <p>Loading...</p>\n      : <UsernameForm/>\n    }\n  </Layout>\n}\n\nexport const query = graphql`\n  query FanStatsData {\n    allVenuesCsv {\n      nodes {\n        id\n        name\n        location\n        capacity\n        generic_name\n        tagname\n      }\n    }\n    allShowsCsv {\n      nodes {\n        date\n        encore1\n        encore2\n        event\n        id\n        links\n        notes\n        num_recordings\n        set1\n        set2\n        set3\n        soundcheck\n        tagline\n        venue_id\n      }\n    }\n    allSetsCsv {\n      nodes {\n        id\n        setlist\n      }\n    }\n    allSongperformancesCsv {\n      nodes {\n        id\n        set_id\n        song_id\n        song_name\n      }\n    }\n    allTeasesCsv {\n      nodes {\n        id\n        performance_id\n        song_id\n        song_name\n      }\n    }\n  }\n`\n"],"names":["sort","comparator","list","Array","prototype","slice","call","pluralize","number","word","numericalSort","a","b","UsernameForm","React","action","type","name","placeholder","size","LinkedUser","_ref","username","href","PageTitle","_ref2","venueURL","_ref3","id","slugify","uniqBySongId","uniqBy","_ref4","song_id","FanStats","_ref5","user","shows","songs","teases","showIDs","Object","keys","venues","uniq","values","map","_ref6","venue","uniqSongs","uniqTeases","length","showID","date","key","Link","to","location","_ref7","song_name","tease","FanStatsPage","_ref8","_userJson$user","data","usernameRaw","URLSearchParams","search","get","userJson","setUserJson","useState","showsData","setShowsData","perfsData","setPerfsData","teasesData","setTeasesData","useEffect","fetch","then","response","json","user_fields","JSON","parse","allSetsCsv","nodes","allSets","allSongperformancesCsv","allSongPerfs","allTeasesCsv","allTeases","allShowsCsv","allShows","allVenuesCsv","allVenues","findSongPerf","find","__","findSet","findShow","findVenue","filterTeases","filter","reduce","showDateString","showDMYYYY","split","replace","showData","propEq","venue_id","setIDs","show","concat","set1","set2","set3","encore1","encore2","Boolean","setID","flatMap","_ref9","setlist","String","songPerfID","perf","Layout","className","SEO","title","error"],"sourceRoot":""}