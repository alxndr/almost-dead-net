"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[80],{4432:function(e,t,n){var l=(0,n(2368).c)((function(e,t){return Array.prototype.slice.call(t,0).sort(e)}));t.c=l},5436:function(e,t,n){function l(e,t){return e+" "+t+(1!==e?"s":"")}n.d(t,{u:function(){return l}})},4484:function(e,t,n){n.r(t),n.d(t,{default:function(){return O}});n(2200);var l=n(1504),a=n(9756),r=n(1732),s=n(5132),c=n(4432),u=n(5188),o=n(7544),m=n(7524),i=n(5240),d=n(6724),E=n.n(d),h=n(1264),f=n(6320),p=n(5436);const g=(e,t)=>e-t,_=()=>l.createElement("form",{action:"/fan-stats"},l.createElement("input",{type:"text",name:"username",placeholder:"your username on The Lot",size:"30"}),l.createElement("button",null,"generate stats")),v=e=>{let{username:t}=e;return l.createElement("a",{href:"https://lot.almost-dead.net/u/"+t+"/summary"},"@",t)},S=e=>{let{username:t}=e;return t?l.createElement(l.Fragment,null,l.createElement(v,{username:t}),"'s Fan Stats"):"Fan Stats"},y=e=>{let{id:t,name:n}=e;return"/venue/"+t+"-"+E()(n)},w=(0,r.c)((e=>{let{song_id:t}=e;return t})),L=e=>{let{user:t,shows:n,songs:r,teases:u}=e;const o=Object.keys(n),m=(0,s.c)(Object.values(n).map((e=>{let{venue:t}=e;return t}))),i=w(r),d=w(u);return l.createElement(l.Fragment,null,l.createElement("p",null,l.createElement(v,{username:t.username})," was at ",(0,p.u)(o.length,"show")," across ",(0,p.u)(m.length,"venue"),", with ",(0,p.u)(i.length,"different song")," performed, and ",(0,p.u)(d.length,"unique song")," teased!"),l.createElement("h2",null,"Shows"),l.createElement("ol",null,(0,c.c)(g,o).map((e=>{const{date:t,venue:r}=n[e];return l.createElement("li",{key:e},l.createElement(a.cH,{to:"/show/"+e},t)," at ",l.createElement(a.cH,{to:y(r)},r.name,", ",r.location))}))),l.createElement("h2",null,"Venues"),l.createElement("ol",null,m.map((e=>l.createElement("li",{key:e.id},l.createElement(a.cH,{to:y(e)},e.name,", ",e.location))))),l.createElement("h2",null,"Songs"),l.createElement("ol",null,i.map((e=>{let{song_id:t,song_name:n}=e;return l.createElement("li",{key:t},l.createElement(a.cH,{to:"/song/"+t},n))}))),l.createElement("h2",null,"Teases"),l.createElement("ol",null,d.map((e=>l.createElement("li",{key:e.song_id},l.createElement(a.cH,{to:"/song/"+e.song_id},e.song_name))))))};function O(e){var t;let{location:n,data:a}=e;const r=new URLSearchParams(n.search).get("username"),{0:s,1:c}=(0,l.useState)(),{0:d,1:E}=(0,l.useState)({}),{0:p,1:g}=(0,l.useState)(),{0:v,1:y}=(0,l.useState)();(0,l.useEffect)((()=>{r&&fetch("https://lot.almost-dead.net/u/"+r+".json").then((e=>e.json())).then((e=>{null!=e&&e.user&&c({user:e.user,shows:e.user.user_fields[1]?JSON.parse(e.user.user_fields[1]):[]})}))}),[r]);const{allSetsCsv:{nodes:w},allSongperformancesCsv:{nodes:O},allTeasesCsv:{nodes:A},allShowsCsv:{nodes:H},allVenuesCsv:{nodes:C}}=a,D=(0,u.c)(o.c,O),F=(0,u.c)(o.c,w),j=(0,u.c)(o.c,H),k=(0,u.c)(o.c,C),b=(0,m.c)(o.c,A);return(0,l.useEffect)((()=>{if(null!=s&&s.shows){const e=s.shows.reduce(((e,t)=>{const n=t.split(" ")[0].replace(/\/(\d{2})$/,"/20$1"),l=j((0,i.c)(n,"date"));if(null!=l&&l.id){const t=k((0,i.c)(l.venue_id,"id"));return{...e,[l.id]:{...l,venue:t}}}return e}),{});E(e);const t=Object.values(e).reduce(((e,t)=>e.concat([t.set1,t.set2,t.set3,t.encore1,t.encore2].filter((e=>Boolean(e))))),[]).map((e=>F((0,i.c)(e,"id")))).flatMap((e=>{let{setlist:t}=e;return String(t).split(":")})).map((e=>D((0,i.c)(e,"id"))));g(t);const n=t.flatMap((e=>b((0,i.c)(e.id,"performance_id"))));y(n)}}),[s]),l.createElement(h.c,{className:"fanstatspage"},l.createElement(f.c,{title:"JRAD Fan Stats"}),l.createElement("h1",null,l.createElement(S,{username:null==s||null===(t=s.user)||void 0===t?void 0:t.username})),r?null!=s&&s.user?Object.keys(d).length?l.createElement(L,{shows:d,songs:p,teases:v,user:s.user}):l.createElement(l.Fragment,null,l.createElement("p",null,"No shows found! (Have you entered them in ",l.createElement("a",{href:"https://lot.almost-dead.net/my/preferences/profile"},"your account preferences on The Lot"),"?)"),l.createElement(_,null)):null!=s&&s.error?l.createElement(l.Fragment,null,l.createElement("p",null,"Uh oh, error fetching data."),l.createElement(_,null)):l.createElement("p",null,"Loading..."):l.createElement(_,null))}}}]);
//# sourceMappingURL=component---src-pages-fan-stats-js-c3def6a64573abf7e62c.js.map