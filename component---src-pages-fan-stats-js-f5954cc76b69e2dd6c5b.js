"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[523],{1458:function(e,n,t){function r(e,n){return e+" "+n+(1!==e?"s":"")}t.d(n,{_:function(){return r}})},673:function(e,n,t){t.r(n),t.d(n,{default:function(){return p}});t(6535),t(9244);var r=t(7294),a=t(5444),l=t(5805),s=t(8650),u=t.n(s),o=t(5127),c=t(6501),m=t(1458),i=function(e,n){return e-n},f=function(){return r.createElement("form",{action:"/fan-stats"},r.createElement("input",{type:"text",name:"username",placeholder:"your username on The Lot",size:"30"}),r.createElement("button",null,"generate stats"))},E=function(e){var n=e.username;return r.createElement("a",{href:"https://lot.almost-dead.net/u/"+n+"/summary"},"@",n)},d=function(e){var n=e.username;return n?r.createElement(r.Fragment,null,r.createElement(E,{username:n}),"'s Fan Stats"):"Fan Stats"},h=function(e){var n=e.id,t=e.name;return"/venue/"+n+"-"+u()(t)},_=(0,l.mNm)((function(e){return e.song_id})),g=function(e){var n=e.user,t=e.shows,s=e.songs,u=e.teases,o=Object.keys(t),c=(0,l.jj$)(Object.values(t).map((function(e){return e.venue}))),f=_(s),d=_(u);return r.createElement(r.Fragment,null,r.createElement("p",null,r.createElement(E,{username:n.username})," was at ",(0,m._)(o.length,"show")," across ",(0,m._)(c.length,"venue"),", with ",(0,m._)(f.length,"different song")," performed, and ",(0,m._)(d.length,"unique song")," teased!"),r.createElement("h2",null,"Shows"),r.createElement("ol",null,(0,l.DYV)(i,o).map((function(e){var n=t[e],l=n.date,s=n.venue;return r.createElement("li",{key:e},r.createElement(a.rU,{to:"/show/"+e},l)," at ",r.createElement(a.rU,{to:h(s)},s.name,", ",s.location))}))),r.createElement("h2",null,"Venues"),r.createElement("ol",null,c.map((function(e){return r.createElement("li",{key:e.id},r.createElement(a.rU,{to:h(e)},e.name,", ",e.location))}))),r.createElement("h2",null,"Songs"),r.createElement("ol",null,f.map((function(e){var n=e.song_id,t=e.song_name;return r.createElement("li",{key:n},r.createElement(a.rU,{to:"/song/"+n},t))}))),r.createElement("h2",null,"Teases"),r.createElement("ol",null,d.map((function(e){return r.createElement("li",{key:e.song_id},r.createElement(a.rU,{to:"/song/"+e.song_id},e.song_name))}))))};function p(e){var n,t=e.location,a=e.data,s=new URLSearchParams(t.search).get("username"),u=(0,r.useState)(),m=u[0],i=u[1],E=(0,r.useState)({}),h=E[0],_=E[1],p=(0,r.useState)(),v=p[0],S=p[1],O=(0,r.useState)(),w=O[0],y=O[1];(0,r.useEffect)((function(){s&&fetch("https://lot.almost-dead.net/u/"+s+".json").then((function(e){return e.json()})).then((function(e){null!=e&&e.user&&i({user:e.user,shows:e.user.user_fields[1]?JSON.parse(e.user.user_fields[1]):[]})}))}),[s]);var j=a.allSetsCsv.nodes,L=a.allSongperformancesCsv.nodes,U=a.allTeasesCsv.nodes,D=a.allShowsCsv.nodes,H=a.allVenuesCsv.nodes,b=(0,l.sEJ)(l.__,L),A=(0,l.sEJ)(l.__,j),C=(0,l.sEJ)(l.__,D),F=(0,l.sEJ)(l.__,H),k=(0,l.hXT)(l.__,U);return(0,r.useEffect)((function(){if(null!=m&&m.shows){var e=m.shows.reduce((function(e,n){var t=n.split(" ")[0].replace(/\/(\d{2})$/,"/20$1"),r=C((0,l.OH4)("date",t));if(null!=r&&r.id){var a,s=F((0,l.OH4)("id",r.venue_id));return Object.assign({},e,((a={})[r.id]=Object.assign({},r,{venue:s}),a))}return e}),{});_(e);var n=Object.values(e).reduce((function(e,n){return e.concat([n.set1,n.set2,n.set3,n.encore1,n.encore2].filter((function(e){return Boolean(e)})))}),[]).map((function(e){return A((0,l.OH4)("id",e))})).flatMap((function(e){var n=e.setlist;return String(n).split(":")})).map((function(e){return b((0,l.OH4)("id",e))}));S(n);var t=n.flatMap((function(e){return k((0,l.OH4)("performance_id",e.id))}));y(t)}}),[m]),r.createElement(o.Z,{className:"fanstatspage"},r.createElement(c.Z,{title:"JRAD Fan Stats"}),r.createElement("h1",null,r.createElement(d,{username:null==m||null===(n=m.user)||void 0===n?void 0:n.username})),s?null!=m&&m.user?Object.keys(h).length?r.createElement(g,{shows:h,songs:v,teases:w,user:m.user}):r.createElement(r.Fragment,null,r.createElement("p",null,"No shows found! (Have you entered them in ",r.createElement("a",{href:"https://lot.almost-dead.net/my/preferences/profile"},"your account preferences on The Lot"),"?)"),r.createElement(f,null)):null!=m&&m.error?r.createElement(r.Fragment,null,r.createElement("p",null,"Uh oh, error fetching data."),r.createElement(f,null)):r.createElement("p",null,"Loading..."):r.createElement(f,null))}}}]);
//# sourceMappingURL=component---src-pages-fan-stats-js-f5954cc76b69e2dd6c5b.js.map