"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[80],{5436:function(e,t,n){function l(e,t){return e+" "+t+(1!==e?"s":"")}n.d(t,{u:function(){return l}})},4484:function(e,t,n){n.r(t),n.d(t,{default:function(){return g}});n(2200);var l=n(1504),a=n(9756),s=n(5420),r=n(6724),u=n.n(r),o=n(1264),c=n(6320),m=n(5436);const i=(e,t)=>e-t,d=()=>l.createElement("form",{action:"/fan-stats"},l.createElement("input",{type:"text",name:"username",placeholder:"your username on The Lot",size:"30"}),l.createElement("button",null,"generate stats")),E=e=>{let{username:t}=e;return l.createElement("a",{href:"https://lot.almost-dead.net/u/"+t+"/summary"},"@",t)},h=e=>{let{username:t}=e;return t?l.createElement(l.Fragment,null,l.createElement(E,{username:t}),"'s Fan Stats"):"Fan Stats"},f=e=>{let{id:t,name:n}=e;return"/venue/"+t+"-"+u()(n)},_=(0,s._eM)((e=>{let{song_id:t}=e;return t})),p=e=>{let{user:t,shows:n,songs:r,teases:u}=e;const o=Object.keys(n),c=(0,s.Ub_)(Object.values(n).map((e=>{let{venue:t}=e;return t}))),d=_(r),h=_(u);return l.createElement(l.Fragment,null,l.createElement("p",null,l.createElement(E,{username:t.username})," was at ",(0,m.u)(o.length,"show")," across ",(0,m.u)(c.length,"venue"),", with ",(0,m.u)(d.length,"different song")," performed, and ",(0,m.u)(h.length,"unique song")," teased!"),l.createElement("h2",null,"Shows"),l.createElement("ol",null,(0,s.yGk)(i,o).map((e=>{const{date:t,venue:s}=n[e];return l.createElement("li",{key:e},l.createElement(a.cH,{to:"/show/"+e},t)," at ",l.createElement(a.cH,{to:f(s)},s.name,", ",s.location))}))),l.createElement("h2",null,"Venues"),l.createElement("ol",null,c.map((e=>l.createElement("li",{key:e.id},l.createElement(a.cH,{to:f(e)},e.name,", ",e.location))))),l.createElement("h2",null,"Songs"),l.createElement("ol",null,d.map((e=>{let{song_id:t,song_name:n}=e;return l.createElement("li",{key:t},l.createElement(a.cH,{to:"/song/"+t},n))}))),l.createElement("h2",null,"Teases"),l.createElement("ol",null,h.map((e=>l.createElement("li",{key:e.song_id},l.createElement(a.cH,{to:"/song/"+e.song_id},e.song_name))))))};function g(e){var t;let{location:n,data:a}=e;const r=new URLSearchParams(n.search).get("username"),{0:u,1:m}=(0,l.useState)(),{0:i,1:E}=(0,l.useState)({}),{0:f,1:_}=(0,l.useState)(),{0:g,1:v}=(0,l.useState)();(0,l.useEffect)((()=>{r&&fetch("https://lot.almost-dead.net/u/"+r+".json").then((e=>e.json())).then((e=>{null!=e&&e.user&&m({user:e.user,shows:e.user.user_fields[1]?JSON.parse(e.user.user_fields[1]):[]})}))}),[r]);const{allSetsCsv:{nodes:w},allSongperformancesCsv:{nodes:S},allTeasesCsv:{nodes:y},allShowsCsv:{nodes:A},allVenuesCsv:{nodes:L}}=a,O=(0,s.iwi)(s.__,S),D=(0,s.iwi)(s.__,w),F=(0,s.iwi)(s.__,A),H=(0,s.iwi)(s.__,L),k=(0,s.IFD)(s.__,y);return(0,l.useEffect)((()=>{if(null!=u&&u.shows){const e=u.shows.reduce(((e,t)=>{const n=t.split(" ")[0].replace(/\/(\d{2})$/,"/20$1"),l=F((0,s.eAo)("date",n));if(null!=l&&l.id){const t=H((0,s.eAo)("id",l.venue_id));return{...e,[l.id]:{...l,venue:t}}}return e}),{});E(e);const t=Object.values(e).reduce(((e,t)=>e.concat([t.set1,t.set2,t.set3,t.encore1,t.encore2].filter((e=>Boolean(e))))),[]).map((e=>D((0,s.eAo)("id",e)))).flatMap((e=>{let{setlist:t}=e;return String(t).split(":")})).map((e=>O((0,s.eAo)("id",e))));_(t);const n=t.flatMap((e=>k((0,s.eAo)("performance_id",e.id))));v(n)}}),[u]),l.createElement(o.c,{className:"fanstatspage"},l.createElement(c.c,{title:"JRAD Fan Stats"}),l.createElement("h1",null,l.createElement(h,{username:null==u||null===(t=u.user)||void 0===t?void 0:t.username})),r?null!=u&&u.user?Object.keys(i).length?l.createElement(p,{shows:i,songs:f,teases:g,user:u.user}):l.createElement(l.Fragment,null,l.createElement("p",null,"No shows found! (Have you entered them in ",l.createElement("a",{href:"https://lot.almost-dead.net/my/preferences/profile"},"your account preferences on The Lot"),"?)"),l.createElement(d,null)):null!=u&&u.error?l.createElement(l.Fragment,null,l.createElement("p",null,"Uh oh, error fetching data."),l.createElement(d,null)):l.createElement("p",null,"Loading..."):l.createElement(d,null))}}}]);
//# sourceMappingURL=component---src-pages-fan-stats-js-f30b7678fc2bddc1b5ec.js.map